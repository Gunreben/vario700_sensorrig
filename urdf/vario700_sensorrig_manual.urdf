<?xml version="1.0" encoding="UTF-8"?>
<robot name="vario700_sensorrig">
  <joint name="sensorrig_joint" type="fixed">
    <origin xyz="0 -1.35969 2.89559" rpy="0 0 1.5707964"/>
    <parent link="base_link"/>
    <child link="sensorrig"/>
  </joint>

  <!-- OS-Sensor Links and Joints -->
  <!-- Currently just manually measured by aligning OS-Sensor Pointcloud with Fendt 724 model -->
  <joint name="joint_base_link-os_sensor" type="fixed">
    <!-- Last manual align on barn: <origin xyz="0.0 0.26 2.98" rpy="0 -0.802851 -1.570796"/> -->
    <origin xyz="0.10 0.26 2.98" rpy="0 -0.812851 -1.570796"/>
    <parent link="base_link"/>
    <child link="os_sensor"/>
  </joint>

  <joint name="os_sensor_to_os_lidar" type="fixed">
    <origin xyz="0 0 0.038195" rpy="-1.570796 0 0"/>
    <parent link="os_sensor"/>
    <child link="os_lidar"/>
  </joint>

  <!-- From Ouster ROS Wrapper -->
  <joint name="os_imu_joint" type="fixed">
    <origin xyz="-0.002441 -0.009725 0.007533" rpy="0 0 0"/>
    <parent link="os_sensor"/>
    <child link="os_imu"/>
  </joint>

  <!-- Camera Links and Joints: Derived from MSA-Calibration -->
  <joint name="joint_os_sensor-blickfeld" type="fixed">
    <origin xyz="1.08013 0.0128897 -1.15956" rpy="0.188916 -3.11455 1.56053"/>
    <parent link="os_sensor"/>
    <child link="Root"/>
  </joint>

  <joint name="joint_os_sensor-camera_rear_left" type="fixed">
    <origin xyz="0.987213 -0.716739 -1.10573" rpy="0.338194 -2.49739 0.754168"/>
    <parent link="os_sensor"/>
    <child link="camera_rear_left"/>
  </joint>

  <!-- Other cameras relative to camera_rear_left -->
  <joint name="joint_camera_rear_left-camera_side_left" type="fixed">
    <parent link="camera_rear_left"/>
    <child link="camera_side_left"/>
    <origin xyz="-0.679383 0.060769 -0.066061" rpy="0.188762 -0.343638 -0.366012"/>
  </joint>
  <!-- Calibration info: RMS=1.0750, image_pairs=16 -->

  <joint name="joint_camera_rear_left-camera_rear_mid" type="fixed">
    <parent link="camera_rear_left"/>
    <child link="camera_rear_mid"/>
    <origin xyz="-0.729568 0.078662 -0.036759" rpy="0.185558 -0.701033 -0.726936"/>
  </joint>
  <!-- Calibration info: RMS=0.8114, image_pairs=9 -->

  <!-- Inverted from camera_rear_right->camera_rear_mid calibration -->
  <joint name="joint_camera_rear_mid-camera_rear_right" type="fixed">
    <parent link="camera_rear_mid"/>
    <child link="camera_rear_right"/>
    <origin xyz="0.556353 0.283049 -0.436192" rpy="0.257379 0.699633 0.660680"/>
  </joint>
  <!-- Calibration info: Inverted from rear_right->rear_mid, original RMS=0.6673, image_pairs=9 -->

  <joint name="joint_camera_rear_right-camera_side_right" type="fixed">
    <parent link="camera_rear_right"/>
    <child link="camera_side_right"/>
    <origin xyz="0.652059 0.085410 -0.138240" rpy="0.363952 0.463761 0.521473"/>
  </joint>



  <!-- ZED Camera Links and Joints -->
  <!-- DEPRECATED -->
  <!-- Manually alligned ZED-Pointcloud with Fendt 724 model / Ouster-Pointcloud -->
  <!-- 
  <joint name="zed_camera_link_joint" type="fixed">
    <origin xyz="0.08 0.26  3.05" rpy="0.0 0.427851 1.570796"/>
    <parent link="base_link"/>
    <child link="zed_camera_link"/>
  </joint>
  -->

  <!-- NEW -->
  <!-- ICP-Registration of ZED-Pointcloud with Ouster-Pointcloud -->
  <!-- Right Camera Frames not included yet -->
  <joint name="zed_left_camera_joint" type="fixed">
    <parent link="os_sensor"/>
    <child link="zed_left_camera_frame"/>
    <!-- ICP from barn, seemed visually off -->
    <!-- <origin xyz="-0.017881 -0.118638 0.062218" rpy="-0.015401 -0.354727 -3.119028"/>  -->
    <!-- ICP Windrow 4 -->
    <origin xyz="-0.026789 -0.098001 0.035757" rpy="-0.019154 -0.401029 -3.126174"/>
  </joint>

   <!-- From ZED ROS Wrapper -->
  <joint name="zed_left_camera_optical_frame_joint" type="fixed">
    <origin xyz="0 0 0" rpy="-1.57079632679 0 -1.57079632679"/>
    <parent link="zed_left_camera_frame"/>
    <child link="zed_left_camera_optical_frame"/>
  </joint>

  <joint name="zed_camera_center_joint" type="fixed">
    <origin xyz="0.010 -0.060 0.000" rpy="0 0 0"/>
    <parent link="zed_left_camera_frame"/>
    <child link="zed_camera_center"/>
  </joint>

  <joint name="zed_right_camera_joint" type="fixed">
    <origin xyz="-0.010 -0.060 0.000" rpy="0 0 0"/>
    <parent link="zed_camera_center"/>
    <child link="zed_right_camera_frame"/>
  </joint>

  <joint name="zed_camera_link_joint" type="fixed">
    <origin xyz="0 0 -0.015" rpy="0 0 0"/>
    <parent link="zed_camera_center"/>
    <child link="zed_camera_link"/>
  </joint>

  <joint name="zed_right_camera_optical_frame_joint" type="fixed">
    <origin xyz="0 0 0" rpy="-1.57079632679 0 -1.57079632679"/>
    <parent link="zed_right_camera_frame"/>
    <child link="zed_right_camera_optical_frame"/>
  </joint>




  <joint name="back_left_joint" type="fixed">
    <origin xyz="-0.929712 -1.05215 0.79196" rpy="0 0 3.1415927"/>
    <parent link="base_link"/>
    <child link="back_left_wheel"/>
  </joint>

  <joint name="back_right_joint" type="fixed">
    <origin xyz="0.929712 -1.05215 0.79196" rpy="0 0 3.1415927"/>
    <parent link="base_link"/>
    <child link="back_right_wheel"/>
  </joint>

  <joint name="front_left_joint" type="fixed">
    <origin xyz="-0.934094 1.72967 0.581455" rpy="0 0 3.1415927"/>
    <parent link="base_link"/>
    <child link="front_left_wheel"/>
  </joint>

  <joint name="front_right_joint" type="fixed">
    <origin xyz="0.934094 1.72967 0.581455" rpy="0 0 3.1415927"/>
    <parent link="base_link"/>
    <child link="front_right_wheel"/>
  </joint>

  <!-- Visual and Collision Links -->
  <!-- Added geometry to make it easier to visualize in Rviz -->
  <link name="camera_rear_left"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>
  <link name="camera_rear_right"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>
  <link name="camera_rear_mid"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>
  <link name="camera_side_left"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>
  <link name="camera_side_right"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>

  <!-- Optical frame links for cameras (ROS convention) -->
  <!-- Transform from camera link frame (X-forward, Y-left, Z-up) to -->
  <!-- optical frame (X-right, Y-down, Z-forward): rpy="-pi/2, 0, -pi/2" -->
  <link name="camera_rear_left_optical_frame"/>
  <joint name="camera_rear_left_optical_joint" type="fixed">
    <parent link="camera_rear_left"/>
    <child link="camera_rear_left_optical_frame"/>
    <origin xyz="0 0 0" rpy="-1.5707963 0 -1.5707963"/>
  </joint>

  <link name="camera_rear_right_optical_frame"/>
  <joint name="camera_rear_right_optical_joint" type="fixed">
    <parent link="camera_rear_right"/>
    <child link="camera_rear_right_optical_frame"/>
    <origin xyz="0 0 0" rpy="-1.5707963 0 -1.5707963"/>
  </joint>

  <link name="camera_rear_mid_optical_frame"/>
  <joint name="camera_rear_mid_optical_joint" type="fixed">
    <parent link="camera_rear_mid"/>
    <child link="camera_rear_mid_optical_frame"/>
    <origin xyz="0 0 0" rpy="-1.5707963 0 -1.5707963"/>
  </joint>

  <link name="camera_side_left_optical_frame"/>
  <joint name="camera_side_left_optical_joint" type="fixed">
    <parent link="camera_side_left"/>
    <child link="camera_side_left_optical_frame"/>
    <origin xyz="0 0 0" rpy="-1.5707963 0 -1.5707963"/>
  </joint>

  <link name="camera_side_right_optical_frame"/>
  <joint name="camera_side_right_optical_joint" type="fixed">
    <parent link="camera_side_right"/>
    <child link="camera_side_right_optical_frame"/>
    <origin xyz="0 0 0" rpy="-1.5707963 0 -1.5707963"/>
  </joint>

  <link name="Root"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>

  <link name="zed_camera_link"></link>
  <link name="zed_camera_center"></link>
  <link name="zed_left_camera_frame"></link>
  <link name="zed_right_camera_frame"></link>
  <!-- <link name="zed_imu_link"></link> -->
  <link name="zed_left_camera_optical_frame"></link>
  <link name="zed_right_camera_optical_frame"></link>

  <link name="os_sensor"><visual><geometry><cylinder radius="0.05" length="0.1"/></geometry></visual></link>
  <link name="os_lidar"/>
  <link name="os_imu"/>


  <!-- Wheel Links and Joints -->
  <!-- Geometry is from Fendt 724 model Farming Simulator 22 -->
  <!-- Needs further refinement, especially in the mass and inertia -->
  <link name="back_left_wheel">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="1"/><inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/back_left_wheel_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/back_left_wheel_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <link name="back_right_wheel">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="1"/><inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/back_right_wheel_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/back_right_wheel_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <link name="base_link">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="10"/><inertia ixx="1" ixy="0" ixz="0" iyy="1" iyz="0" izz="1"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/base_link_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/base_link_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <link name="front_left_wheel">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="1"/><inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/front_left_wheel_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/front_left_wheel_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <link name="front_right_wheel">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="1"/><inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/front_right_wheel_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/front_right_wheel_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <!-- Sensorrig Links and Joints -->
  <!-- Handmade CAD Model -->
  <link name="sensorrig">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="2"/><inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/sensorrig_visuals.obj" scale="0.001 0.001 0.001"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/sensorrig_collisions.obj" scale="0.001 0.001 0.001"/></geometry></collision>
  </link>
</robot>
