<?xml version="1.0" encoding="UTF-8"?>
<robot name="vario700_sensorrig">
  <joint name="sensorrig_joint" type="fixed">
    <origin xyz="0 -1.35969 2.89559" rpy="0 0 1.5707964"/>
    <parent link="base_link"/>
    <child link="sensorrig"/>
  </joint>

  <!-- OS-Sensor Links and Joints -->
  <!-- Currently just manually measured by aligning OS-Sensor Pointcloud with Fendt 724 model -->
  <joint name="joint_base_link-os_sensor" type="fixed">
    <!-- Last manual align on barn: <origin xyz="0.0 0.26 2.98" rpy="0 -0.802851 -1.570796"/> -->
    <origin xyz="0.10 0.26 2.98" rpy="0 -0.812851 -1.570796"/>
    <parent link="base_link"/>
    <child link="os_sensor"/>
  </joint>

  <joint name="os_sensor_to_os_lidar" type="fixed">
    <origin xyz="0 0 0.038195" rpy="0 0 0"/>
    <parent link="os_sensor"/>
    <child link="os_lidar"/>
  </joint>

  <!-- From Ouster ROS Wrapper -->
  <joint name="os_imu_joint" type="fixed">
    <origin xyz="-0.002441 -0.009725 0.007533" rpy="0 -1.570796 0"/>
    <parent link="os_sensor"/>
    <child link="os_imu"/>
  </joint>

  <!-- Camera Links and Joints: Chain from Kalibr calibration -->
  <!-- Chain: os_sensor -> side_right -> rear_right -> rear_mid -> rear_left -> side_left -->
  <!-- rear_mid position preserved relative to os_sensor from previous calibration -->

  <!-- os_sensor -> side_right: Computed to maintain rear_mid's absolute position -->
  <joint name="joint_os_sensor-camera_side_right" type="fixed">
    <origin xyz="0.522142 0.877865 -0.631033" rpy="-2.27836 0.834522 0.0180667"/>
    <parent link="os_sensor"/>
    <child link="camera_side_right"/>
  </joint>

  <!-- side_right -> rear_right: From Kalibr cam1 T_cn_cnm1 (inverted) -->
  <joint name="joint_camera_side_right-camera_rear_right" type="fixed">
    <origin xyz="0.6585 0.0785 -0.1081" rpy="0.3517 0.4557 0.5183"/>
    <parent link="camera_side_right"/>
    <child link="camera_rear_right"/>
  </joint>

  <!-- rear_right -> rear_mid: From Kalibr cam2 T_cn_cnm1 (inverted) -->
  <joint name="joint_camera_rear_right-camera_rear_mid" type="fixed">
    <origin xyz="0.5371 0.2753 -0.4252" rpy="0.2365 0.7268 0.6693"/>
    <parent link="camera_rear_right"/>
    <child link="camera_rear_mid"/>
  </joint>

  <!-- rear_mid -> rear_left: From Kalibr cam3 T_cn_cnm1 (inverted) -->
  <joint name="joint_camera_rear_mid-camera_rear_left" type="fixed">
    <origin xyz="0.7371 0.0765 -0.0433" rpy="0.1261 0.7369 0.7252"/>
    <parent link="camera_rear_mid"/>
    <child link="camera_rear_left"/>
  </joint>

  <!-- rear_left -> side_left: From Kalibr cam4 T_cn_cnm1 (inverted) -->
  <joint name="joint_camera_rear_left-camera_side_left" type="fixed">
    <origin xyz="0.6224 0.1106 -0.2244" rpy="-0.2752 0.4740 0.2358"/>
    <parent link="camera_rear_left"/>
    <child link="camera_side_left"/>
  </joint>

  <!-- Blickfeld attached to rear_mid -->
  <joint name="joint_camera_rear_mid-blickfeld" type="fixed">
    <origin xyz="0.0 0.0 0.0" rpy="1.5708 0.0 -1.5708"/>
    <parent link="camera_rear_mid"/>
    <child link="Root"/>
  </joint>


  <!-- ZED Camera Links and Joints -->
  <!-- DEPRECATED -->
  <!-- Manually alligned ZED-Pointcloud with Fendt 724 model / Ouster-Pointcloud -->
  <!-- 
  <joint name="zed_camera_link_joint" type="fixed">
    <origin xyz="0.08 0.26  3.05" rpy="0.0 0.427851 1.570796"/>
    <parent link="base_link"/>
    <child link="zed_camera_link"/>
  </joint>
  -->

  <!-- NEW -->
  <!-- ICP-Registration of ZED-Pointcloud with Ouster-Pointcloud -->
  <!-- Right Camera Frames not included yet -->
  <joint name="zed_left_camera_joint" type="fixed">
    <parent link="os_sensor"/>
    <child link="zed_left_camera_frame"/>
    <!-- ICP from barn, seemed visually off -->
    <!-- <origin xyz="-0.017881 -0.118638 0.062218" rpy="-0.015401 -0.354727 -3.119028"/>  -->
    <!-- ICP Windrow 4 -->
    <!-- <origin xyz="-0.026789 -0.098001 0.035757" rpy="-0.019154 -0.401029 -3.126174"/>  -->
    <!-- ICP Garage -->
    <origin xyz="0.166753 -0.157008 -0.192582" rpy="-0.007683 -0.361936 -3.122481"/>
  </joint>

   <!-- From ZED ROS Wrapper -->
  <joint name="zed_left_camera_optical_frame_joint" type="fixed">
    <origin xyz="0 0 0" rpy="-1.57079632679 0 -1.57079632679"/>
    <parent link="zed_left_camera_frame"/>
    <child link="zed_left_camera_optical_frame"/>
  </joint>

  <joint name="zed_camera_center_joint" type="fixed">
    <origin xyz="0.010 -0.060 0.000" rpy="0 0 0"/>
    <parent link="zed_left_camera_frame"/>
    <child link="zed_camera_center"/>
  </joint>

  <joint name="zed_right_camera_joint" type="fixed">
    <origin xyz="-0.010 -0.060 0.000" rpy="0 0 0"/>
    <parent link="zed_camera_center"/>
    <child link="zed_right_camera_frame"/>
  </joint>

  <joint name="zed_camera_link_joint" type="fixed">
    <origin xyz="0 0 -0.015" rpy="0 0 0"/>
    <parent link="zed_camera_center"/>
    <child link="zed_camera_link"/>
  </joint>

  <joint name="zed_right_camera_optical_frame_joint" type="fixed">
    <origin xyz="0 0 0" rpy="-1.57079632679 0 -1.57079632679"/>
    <parent link="zed_right_camera_frame"/>
    <child link="zed_right_camera_optical_frame"/>
  </joint>




  <joint name="back_left_joint" type="fixed">
    <origin xyz="-0.929712 -1.05215 0.79196" rpy="0 0 3.1415927"/>
    <parent link="base_link"/>
    <child link="back_left_wheel"/>
  </joint>

  <joint name="back_right_joint" type="fixed">
    <origin xyz="0.929712 -1.05215 0.79196" rpy="0 0 3.1415927"/>
    <parent link="base_link"/>
    <child link="back_right_wheel"/>
  </joint>

  <joint name="front_left_joint" type="fixed">
    <origin xyz="-0.934094 1.72967 0.581455" rpy="0 0 3.1415927"/>
    <parent link="base_link"/>
    <child link="front_left_wheel"/>
  </joint>

  <joint name="front_right_joint" type="fixed">
    <origin xyz="0.934094 1.72967 0.581455" rpy="0 0 3.1415927"/>
    <parent link="base_link"/>
    <child link="front_right_wheel"/>
  </joint>

  <!-- Visual and Collision Links -->
  <!-- Added geometry to make it easier to visualize in Rviz -->
  <link name="camera_rear_left"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>
  <link name="camera_rear_right"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>
  <link name="camera_rear_mid"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>
  <link name="camera_side_left"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>
  <link name="camera_side_right"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>

  <link name="Root"><visual><geometry><box size="0.05 0.05 0.05"/></geometry></visual></link>

  <link name="zed_camera_link"></link>
  <link name="zed_camera_center"></link>
  <link name="zed_left_camera_frame"></link>
  <link name="zed_right_camera_frame"></link>
  <!-- <link name="zed_imu_link"></link> -->
  <link name="zed_left_camera_optical_frame"></link>
  <link name="zed_right_camera_optical_frame"></link>

  <link name="os_sensor"><visual><geometry><cylinder radius="0.05" length="0.1"/></geometry></visual></link>
  <link name="os_lidar"/>
  <link name="os_imu"/>


  <!-- Wheel Links and Joints -->
  <!-- Geometry is from Fendt 724 model Farming Simulator 22 -->
  <!-- Needs further refinement, especially in the mass and inertia -->
  <link name="back_left_wheel">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="1"/><inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/back_left_wheel_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/back_left_wheel_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <link name="back_right_wheel">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="1"/><inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/back_right_wheel_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/back_right_wheel_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <link name="base_link">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="10"/><inertia ixx="1" ixy="0" ixz="0" iyy="1" iyz="0" izz="1"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/base_link_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/base_link_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <link name="front_left_wheel">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="1"/><inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/front_left_wheel_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/front_left_wheel_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <link name="front_right_wheel">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="1"/><inertia ixx="0.01" ixy="0" ixz="0" iyy="0.01" iyz="0" izz="0.01"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/front_right_wheel_visuals.obj" scale="0.1 0.1 0.1"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/front_right_wheel_collisions.obj" scale="0.1 0.1 0.1"/></geometry></collision>
  </link>

  <!-- Sensorrig Links and Joints -->
  <!-- Handmade CAD Model -->
  <link name="sensorrig">
    <inertial><origin xyz="0 0 0" rpy="0 0 0"/><mass value="2"/><inertia ixx="0.1" ixy="0" ixz="0" iyy="0.1" iyz="0" izz="0.1"/></inertial>
    <visual><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/sensorrig_visuals.obj" scale="0.001 0.001 0.001"/></geometry></visual>
    <collision><origin xyz="0 0 0" rpy="0 0 0"/><geometry><mesh filename="package://vario700_sensorrig/meshes/sensorrig_collisions.obj" scale="0.001 0.001 0.001"/></geometry></collision>
  </link>
</robot>
